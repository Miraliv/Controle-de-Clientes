<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apiário Avoante</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
        .navbar-custom {
            background-color: #f8d568;
        }
        .table td, .table th {
            vertical-align: middle;
        }
        .btn-isolated {
            margin-left: auto;
        }
        .status-bold {
            font-weight: bold;
        }
        .table tbody tr:nth-child(odd) {
            background-color: #f2f2f2;
        }
        .table tbody tr:nth-child(even) {
            background-color: #ffffff;
        }
        .status-warning {
            color: #ffc107;
        }
        .status-success {
            color: #28a745;
        }
        .status-danger {
            color: #dc3545;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-custom">
        <span class="navbar-brand mb-0 h1">Apiário Avoante</span>
    </nav>

    <!-- Nome colheita -->
    <h1 id="harvestNameTitle" class="mt-4"></h1>

    <!--  -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
            <button id="addHarvestButton" class="btn btn-primary" data-toggle="modal" data-target="#addHarvestModal">Adicionar Colheita</button>
            <div class="dropdown d-inline-block">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="harvestDropdownButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Selecionar Colheita
                </button>
                <div class="dropdown-menu" aria-labelledby="harvestDropdownButton" id="harvestDropdownMenu">
                    <!--  -->
                </div>
            </div>
        </div>
        <div class="d-inline-block">
            <button id="addCustomerButton" class="btn btn-success btn-isolated" disabled data-toggle="modal" data-target="#addCustomerModal">Adicionar Cliente</button>
            <div class="dropdown d-inline-block">
                <button class="btn btn-info dropdown-toggle" type="button" id="filterDropdownButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Filtrar Clientes
                </button>
                <div class="dropdown-menu" aria-labelledby="filterDropdownButton" id="filterDropdownMenu">
                    <a class="dropdown-item" href="#" onclick="filterCustomers('Todos')">Todos os clientes</a>
                    <a class="dropdown-item" href="#" onclick="filterCustomers('Quer comprar')">Querem comprar</a>
                    <a class="dropdown-item" href="#" onclick="filterCustomers('Já pagou')">Já pagaram</a>
                    <a class="dropdown-item" href="#" onclick="filterCustomers('Falta pagar')">Faltam pagar</a>
                </div>
            </div>
        </div>
    </div>

    <!--  -->
    <div id="harvestData" class="mt-3"></div>

    <!--  -->
    <div id="tablesContent" class="mt-4"></div>

    <!--  -->
    <div class="modal fade" id="addHarvestModal" tabindex="-1" aria-labelledby="addHarvestModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form id="addHarvestForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addHarvestModalLabel">Adicionar Nova Colheita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="harvestName">Nome da Colheita</label>
                        <input type="text" class="form-control" id="harvestName" required>
                    </div>
                    <div class="form-group">
                        <label for="harvestHoneyJars">Total de Garrafas de Mel</label>
                        <input type="number" class="form-control" id="harvestHoneyJars" required>
                    </div>
                    <div class="form-group">
                        <label for="harvestHoneycombs">Total de Potes de Favo</label>
                        <input type="number" class="form-control" id="harvestHoneycombs" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Salvar Colheita</button>
                </div>
            </form>
        </div>
    </div>

    <!--  -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form id="addCustomerForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCustomerModalLabel">Adicionar Cliente</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="customerName">Nome do Cliente</label>
                        <input type="text" class="form-control" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">Telefone</label>
                        <input type="text" class="form-control" id="customerPhone" placeholder="(xx) xxxxx-xxxx" required>
                    </div>
                    <div class="form-group">
                        <label for="customerStatus">Situação</label>
                        <select class="form-control" id="customerStatus" required>
                            <option value="Quer comprar">Quer comprar</option>
                            <option value="Já pagou">Já pagou</option>
                            <option value="Falta pagar">Falta pagar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="customerHoneyJars">Garrafas de Mel</label>
                        <input type="number" class="form-control" id="customerHoneyJars" required>
                    </div>
                    <div class="form-group">
                        <label for="customerHoneycombs">Potes de Favo</label>
                        <input type="number" class="form-control" id="customerHoneycombs" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-success">Adicionar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!--  -->
    <div class="modal fade" id="updateCustomerModal" tabindex="-1" aria-labelledby="updateCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form id="updateCustomerForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateCustomerModalLabel">Atualizar Cliente</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="updateCustomerIndex">
                    <div class="form-group">
                        <label for="updateCustomerName">Nome do Cliente</label>
                        <input type="text" class="form-control" id="updateCustomerName" required>
                    </div>
                    <div class="form-group">
                        <label for="updateCustomerPhone">Telefone</label>
                        <input type="text" class="form-control" id="updateCustomerPhone" placeholder="(xx) xxxxx-xxxx" required>
                    </div>
                    <div class="form-group">
                        <label for="updateCustomerStatus">Situação</label>
                        <select class="form-control" id="updateCustomerStatus" required>
                            <option value="Quer comprar">Quer comprar</option>
                            <option value="Já pagou">Já pagou</option>
                            <option value="Falta pagar">Falta pagar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="updateCustomerHoneyJars">Garrafas de Mel</label>
                        <input type="number" class="form-control" id="updateCustomerHoneyJars" required>
                    </div>
                    <div class="form-group">
                        <label for="updateCustomerHoneycombs">Potes de Favo</label>
                        <input type="number" class="form-control" id="updateCustomerHoneycombs" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Atualizar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dependências -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <!--  -->
    <script>
        let harvests = [];
        let selectedHarvestIndex = -1;

        $(document).ready(function() {

            $('#addHarvestForm').on('submit', function(event) {
                event.preventDefault();
                const harvestName = $('#harvestName').val();
                const harvestHoneyJars = $('#harvestHoneyJars').val();
                const harvestHoneycombs = $('#harvestHoneycombs').val();

                const newHarvest = {
                    name: harvestName,
                    honeyJars: harvestHoneyJars,
                    honeycombs: harvestHoneycombs,
                    customers: []
                };

                harvests.push(newHarvest);
                updateHarvestDropdown();
                $('#addHarvestModal').modal('hide');
            });


            $('#addCustomerForm').on('submit', function(event) {
                event.preventDefault();
                const customerName = $('#customerName').val();
                const customerPhone = $('#customerPhone').val();
                const customerStatus = $('#customerStatus').val();
                const customerHoneyJars = $('#customerHoneyJars').val();
                const customerHoneycombs = $('#customerHoneycombs').val();

                const newCustomer = {
                    name: customerName,
                    phone: customerPhone,
                    status: customerStatus,
                    honeyJars: customerHoneyJars,
                    honeycombs: customerHoneycombs
                };

                if (selectedHarvestIndex !== -1) {
                    harvests[selectedHarvestIndex].customers.push(newCustomer);
                    updateCustomerTable();
                    $('#addCustomerModal').modal('hide');
                }
            });


            $('#updateCustomerForm').on('submit', function(event) {
                event.preventDefault();
                const customerIndex = $('#updateCustomerIndex').val();
                const customerName = $('#updateCustomerName').val();
                const customerPhone = $('#updateCustomerPhone').val();
                const customerStatus = $('#updateCustomerStatus').val();
                const customerHoneyJars = $('#updateCustomerHoneyJars').val();
                const customerHoneycombs = $('#updateCustomerHoneycombs').val();

                if (selectedHarvestIndex !== -1) {
                    harvests[selectedHarvestIndex].customers[customerIndex] = {
                        name: customerName,
                        phone: customerPhone,
                        status: customerStatus,
                        honeyJars: customerHoneyJars,
                        honeycombs: customerHoneycombs
                    };

                    updateCustomerTable();
                    $('#updateCustomerModal').modal('hide');
                }
            });


            updateHarvestDropdown();
        });


        function updateHarvestDropdown() {
            const harvestDropdownMenu = $('#harvestDropdownMenu');
            harvestDropdownMenu.empty();

            harvests.forEach((harvest, index) => {
                harvestDropdownMenu.append(`<a class="dropdown-item" href="#" onclick="selectHarvest(${index})">${harvest.name}</a>`);
            });

            if (harvests.length > 0 && selectedHarvestIndex === -1) {
                selectHarvest(0);
            }
        }


        function selectHarvest(index) {
            selectedHarvestIndex = index;
            const harvest = harvests[index];
            $('#harvestNameTitle').text(harvest.name);
            $('#addCustomerButton').prop('disabled', false);
            updateCustomerTable();
        }


        function updateCustomerTable() {
            filterCustomers('Todos');
        }


        function filterCustomers(status) {
            const harvest = harvests[selectedHarvestIndex];
            let filteredCustomers = harvest.customers;

            if (status !== 'Todos') {
                filteredCustomers = harvest.customers.filter(customer => customer.status === status);
            }

            const tableContent = `
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Telefone</th>
                            <th>Situação</th>
                            <th>Garrafas de Mel</th>
                            <th>Potes de Favo</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCustomers.map((customer, index) => `
                            <tr>
                                <td>${customer.name}</td>
                                <td>${customer.phone}</td>
                                <td class="status-bold ${getStatusClass(customer.status)}">${customer.status}</td>
                                <td>${customer.honeyJars}</td>
                                <td>${customer.honeycombs}</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCustomer(${index})">Editar</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${index})">Excluir</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            $('#tablesContent').html(tableContent);
        }


        function getStatusClass(status) {
            if (status === 'Quer comprar') return 'status-warning';
            if (status === 'Já pagou') return 'status-success';
            if (status === 'Falta pagar') return 'status-danger';
            return '';
        }


        function editCustomer(index) {
            const customer = harvests[selectedHarvestIndex].customers[index];
            $('#updateCustomerIndex').val(index);
            $('#updateCustomerName').val(customer.name);
            $('#updateCustomerPhone').val(customer.phone);
            $('#updateCustomerStatus').val(customer.status);
            $('#updateCustomerHoneyJars').val(customer.honeyJars);
            $('#updateCustomerHoneycombs').val(customer.honeycombs);
            $('#updateCustomerModal').modal('show');
        }


        function deleteCustomer(index) {
            harvests[selectedHarvestIndex].customers.splice(index, 1);
            updateCustomerTable();
        }
    </script>

</body>
</html>
